{"name":"Database indexing example","tagline":"A demo app to demonstrate the advantage of using indexing in database","body":"#Using add_index in your migrations#\r\n\r\nI had been working on a project lately that involved a huge lot of table and migrations. I thought I was doing well with the tables using associations and all and thought the system to work well. But when I ported the application to production mode from the development mode, things began to slow down. I was curious on what was slowing down my app. So I decided to dig deep into the logs.\r\n\r\n###What was missing?###\r\n<br>\r\nA deeper analysis on the logs gave me a clear idea on my mistake. I could find that the queries, esp the select querues, are taking a lot of time to get executed.\r\n\r\n###Understanding the Problem###\r\n<br>\r\nMy application had a Users table which have more than 10K registered  and active users in that. And I had a search function using which I used the First Name of users for searching a user.\r\n\r\n`@user = User.where(first_name:\"Manu\")`\r\n\r\nWhat this basically does is a searching. It would search the users table for users having first_name as \"Manu\". If the user who you are searching is at the bottom of the table then you are in great trouble.\r\n\r\n###Solution to the Problem - Indexing###\r\n<br>\r\nThe best solution for this problem, was to avoid the searching and directly select the user from the table. for this I had to  add index to my table.\r\nSo I wrote a migration to add the same\r\n```\r\ndef self.up\r\n  add_index :users, :first_name\r\nend\r\n\r\ndef self.down\r\n  remove_index :users, :first_name\r\nend\r\n```\r\nNow instead of searching the users it will use the index to select the user from the table.\r\n\r\nAt this point you would be probably thinking of adding index to all the fields in your table and making your search queries lightning fast. But there is always two sides of a coin. As adding index to your tables makes your search queries faster, on the other side it will make the insertion and updation slower. As every time a record is inserted or modified the index needs to be updated.\r\n<br>\r\nConsidering the insertion is one time and updation is done less often, I would prefer to add index for the fields on my table.\r\n\r\n###Demo App###\r\n<br>\r\nI have made a demo app to demonstrate the same. The `home_controller.rb` has a search action using which the users can be searched by their first name.\r\nBefore adding the index to the database searching a user among 10,000 users took about 18.2ms. But this dropped to 0.4ms on adding index to the first name.\r\n\r\nIf you want to try out the app using rails console then,\r\n\r\n```\r\n#enter the rails console\r\nrails c\r\n\r\n#perform a search query to search a user with first name \"user10000\"\r\nuser = User.where('first_name = ?', \"user10000\").first.first_name\r\n```\r\n\r\n--\r\n<br>\r\nManu S Ajith\r\n<br>\r\n[@manusajith](http://twitter.com/manusajith \"@manusajith\") | [github](http://github.com/manusajith \"@manusajith\")","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}