<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Database indexing example by manusajith</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Database indexing example</h1>
        <h2>A demo app to demonstrate the advantage of using indexing in database</h2>
        <a href="https://github.com/manusajith/database_indexing_example" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>Using add_index in your migrations</h1>

<p>I had been working on a project lately that involved a huge lot of table and migrations. I thought I was doing well with the tables using associations and all and thought the system to work well. But when I ported the application to production mode from the development mode, things began to slow down. I was curious on what was slowing down my app. So I decided to dig deep into the logs.</p>

<h3>What was missing?</h3>

<p><br>
A deeper analysis on the logs gave me a clear idea on my mistake. I could find that the queries, esp the select querues, are taking a lot of time to get executed.</p>

<h3>Understanding the Problem</h3>

<p><br>
My application had a Users table which have more than 10K registered  and active users in that. And I had a search function using which I used the First Name of users for searching a user.</p>

<p><code>@user = User.where(first_name:"Manu")</code></p>

<p>What this basically does is a searching. It would search the users table for users having first_name as "Manu". If the user who you are searching is at the bottom of the table then you are in great trouble.</p>

<h3>Solution to the Problem - Indexing</h3>

<p><br>
The best solution for this problem, was to avoid the searching and directly select the user from the table. for this I had to  add index to my table.
So I wrote a migration to add the same</p>

<pre><code>def self.up
  add_index :users, :first_name
end

def self.down
  remove_index :users, :first_name
end
</code></pre>

<p>Now instead of searching the users it will use the index to select the user from the table.</p>

<p>At this point you would be probably thinking of adding index to all the fields in your table and making your search queries lightning fast. But there is always two sides of a coin. As adding index to your tables makes your search queries faster, on the other side it will make the insertion and updation slower. As every time a record is inserted or modified the index needs to be updated.
<br>
Considering the insertion is one time and updation is done less often, I would prefer to add index for the fields on my table.</p>

<h3>Demo App</h3>

<p><br>
I have made a demo app to demonstrate the same. The <code>home_controller.rb</code> has a search action using which the users can be searched by their first name.
Before adding the index to the database searching a user among 10,000 users took about 18.2ms. But this dropped to 0.4ms on adding index to the first name.</p>

<p>If you want to try out the app using rails console then,</p>

<pre><code>#enter the rails console
rails c

#perform a search query to search a user with first name "user10000"
user = User.where('first_name = ?', "user10000").first.first_name
</code></pre>

<h2></h2>

<p><br>
Manu S Ajith
<br><a href="http://twitter.com/manusajith" title="@manusajith">@manusajith</a> | <a href="http://github.com/manusajith" title="@manusajith">github</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/manusajith/database_indexing_example/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/manusajith/database_indexing_example/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/manusajith/database_indexing_example"></a> is maintained by <a href="https://github.com/manusajith">manusajith</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>